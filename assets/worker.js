!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/assets/",n(n.s=145)}({145:function(t,e,n){"use strict";n(146)},146:function(t,e,n){"use strict";var o=n(30),r=n(147),s=i(n(150));function i(t){return t&&t.__esModule?t:{default:t}}var u=void 0;(0,i(n(148)).default)((function(t){switch(t.type){case o.MESSAGE_TO_WORKER.FETCH:return(0,r.fetchQuakes)(3).then((function(t){return u=new s.default({radius:60,extent:256,maxZoom:17}).load(t.features),{ready:!0}}));case o.MESSAGE_TO_WORKER.SEARCH:return(0,r.searchQuakes)(t.query).then((function(e){return{results:(u=new s.default({radius:60,extent:256,maxZoom:17}).load(e.features)).getClusters(t.bbox,t.zoom)}}));case o.MESSAGE_TO_WORKER.ZOOM:return{results:u.getClusters(t.bbox,t.zoom)};case o.MESSAGE_TO_WORKER.EXPANSION:return{expansion:u.getClusterExpansionZoom(t.expansion),center:t.center};default:return{type:"failed"}}}))},147:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.fetchQuakes=function(t){return new Promise((function(e,n){var s=new Date,i=new Date;i.setMonth(i.getMonth()-1),r(o+"&starttime="+i.toDateString()+"&endtime="+s.toDateString()+"&minmagnitude="+t,(function(t,o){if(t)return n(t);e(o)}))}))},e.searchQuakes=function(t){return new Promise((function(e,n){var s=t.magnitude,i=t.mindate,u=t.maxdate;r(o+"&starttime="+i+"&endtime="+u+"&minmagnitude="+s,(function(t,o){if(t)return n(t);e(o)}))}))};var o="https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson";function r(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="json",n.setRequestHeader("Accept","application/json"),n.onload=function(){4===n.readyState&&n.status>=200&&n.status<300&&n.response?e(null,n.response):e(new Error("failed to load api"))},n.send()}},148:function(t,e,n){"use strict";t.exports=function(t){function e(t,e,n,o){function r(e){"function"!=typeof self.postMessage?t.ports[0].postMessage(e):self.postMessage(e)}n?("undefined"!=typeof console&&"error"in console&&console.error("Worker caught an error:",n),r([e,{message:n.message}])):r([e,null,o])}self.addEventListener("message",(function(n){var o=n.data;if(Array.isArray(o)&&2===o.length){var r=o[0],s=o[1];"function"!=typeof t?e(n,r,new Error("Please pass a function into register().")):function(t,n,o,r){var s=function(t,e){try{return{res:t(e)}}catch(t){return{err:t}}}(n,r);s.err?e(t,o,s.err):function(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}(s.res)?s.res.then((function(n){e(t,o,null,n)}),(function(n){e(t,o,n)})):e(t,o,null,s.res)}(n,t,r,s)}}))}},150:function(t,e,n){"use strict";function o(t,e,n,s,i,u){if(i-s<=n)return;const a=s+i>>1;!function t(e,n,o,s,i,u){for(;i>s;){if(i-s>600){const r=i-s+1,a=o-s+1,c=Math.log(r),p=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*p*(r-p)/r)*(a-r/2<0?-1:1);t(e,n,o,Math.max(s,Math.floor(o-a*p/r+f)),Math.min(i,Math.floor(o+(r-a)*p/r+f)),u)}const a=n[2*o+u];let c=s,p=i;for(r(e,n,s,o),n[2*i+u]>a&&r(e,n,s,i);c<p;){for(r(e,n,c,p),c++,p--;n[2*c+u]<a;)c++;for(;n[2*p+u]>a;)p--}n[2*s+u]===a?r(e,n,s,p):r(e,n,++p,i),p<=o&&(s=p+1),o<=p&&(i=p-1)}}(t,e,a,s,i,u%2),o(t,e,n,s,a-1,u+1),o(t,e,n,a+1,i,u+1)}function r(t,e,n,o){s(t,n,o),s(e,2*n,2*o),s(e,2*n+1,2*o+1)}function s(t,e,n){const o=t[e];t[e]=t[n],t[n]=o}function i(t,e,n,o){const r=t-n,s=e-o;return r*r+s*s}n.r(e),n.d(e,"default",(function(){return f}));const u=t=>t[0],a=t=>t[1];class c{constructor(t,e=u,n=a,r=64,s=Float64Array){this.nodeSize=r,this.points=t;const i=t.length<65536?Uint16Array:Uint32Array,c=this.ids=new i(t.length),p=this.coords=new s(2*t.length);for(let o=0;o<t.length;o++)c[o]=o,p[2*o]=e(t[o]),p[2*o+1]=n(t[o]);o(c,p,r,0,c.length-1,0)}range(t,e,n,o){return function(t,e,n,o,r,s,i){const u=[0,t.length-1,0],a=[];let c,p;for(;u.length;){const f=u.pop(),h=u.pop(),l=u.pop();if(h-l<=i){for(let i=l;i<=h;i++)c=e[2*i],p=e[2*i+1],c>=n&&c<=r&&p>=o&&p<=s&&a.push(t[i]);continue}const d=Math.floor((l+h)/2);c=e[2*d],p=e[2*d+1],c>=n&&c<=r&&p>=o&&p<=s&&a.push(t[d]);const m=(f+1)%2;(0===f?n<=c:o<=p)&&(u.push(l),u.push(d-1),u.push(m)),(0===f?r>=c:s>=p)&&(u.push(d+1),u.push(h),u.push(m))}return a}(this.ids,this.coords,t,e,n,o,this.nodeSize)}within(t,e,n){return function(t,e,n,o,r,s){const u=[0,t.length-1,0],a=[],c=r*r;for(;u.length;){const p=u.pop(),f=u.pop(),h=u.pop();if(f-h<=s){for(let r=h;r<=f;r++)i(e[2*r],e[2*r+1],n,o)<=c&&a.push(t[r]);continue}const l=Math.floor((h+f)/2),d=e[2*l],m=e[2*l+1];i(d,m,n,o)<=c&&a.push(t[l]);const g=(p+1)%2;(0===p?n-r<=d:o-r<=m)&&(u.push(h),u.push(l-1),u.push(g)),(0===p?n+r>=d:o+r>=m)&&(u.push(l+1),u.push(f),u.push(g))}return a}(this.ids,this.coords,t,e,n,this.nodeSize)}}const p={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:t=>t};class f{constructor(t){this.options=M(Object.create(p),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:n,maxZoom:o,nodeSize:r}=this.options;e&&console.time("total time");const s=`prepare ${t.length} points`;e&&console.time(s),this.points=t;let i=[];for(let e=0;e<t.length;e++)t[e].geometry&&i.push(l(t[e],e));this.trees[o+1]=new c(i,x,_,r,Float32Array),e&&console.timeEnd(s);for(let t=o;t>=n;t--){const n=+Date.now();i=this._cluster(i,t),this.trees[t]=new c(i,x,_,r,Float32Array),e&&console.log("z%d: %d clusters in %dms",t,i.length,+Date.now()-n)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let n=((t[0]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const s=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){const t=this.getClusters([n,o,180,s],e),i=this.getClusters([-180,o,r,s],e);return t.concat(i)}const i=this.trees[this._limitZoom(e)],u=i.range(g(n),y(s),g(r),y(o)),a=[];for(const t of u){const e=i.points[t];a.push(e.numPoints?d(e):this.points[e.index])}return a}getChildren(t){const e=t>>5,n=t%32,o="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(o);const s=r.points[e];if(!s)throw new Error(o);const i=this.options.radius/(this.options.extent*Math.pow(2,n-1)),u=r.within(s.x,s.y,i),a=[];for(const e of u){const n=r.points[e];n.parentId===t&&a.push(n.numPoints?d(n):this.points[n.index])}if(0===a.length)throw new Error(o);return a}getLeaves(t,e,n){e=e||10,n=n||0;const o=[];return this._appendLeaves(o,t,e,n,0),o}getTile(t,e,n){const o=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:s,radius:i}=this.options,u=i/s,a=(n-u)/r,c=(n+1+u)/r,p={features:[]};return this._addTileFeatures(o.range((e-u)/r,a,(e+1+u)/r,c),o.points,e,n,r,p),0===e&&this._addTileFeatures(o.range(1-u/r,a,1,c),o.points,r,n,r,p),e===r-1&&this._addTileFeatures(o.range(0,a,u/r,c),o.points,-1,n,r,p),p.features.length?p:null}getClusterExpansionZoom(t){let e=t%32-1;for(;e<=this.options.maxZoom;){const n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e}_appendLeaves(t,e,n,o,r){const s=this.getChildren(e);for(const e of s){const s=e.properties;if(s&&s.cluster?r+s.point_count<=o?r+=s.point_count:r=this._appendLeaves(t,s.cluster_id,n,o,r):r<o?r++:t.push(e),t.length===n)break}return r}_addTileFeatures(t,e,n,o,r,s){for(const i of t){const t=e[i],u={type:1,geometry:[[Math.round(this.options.extent*(t.x*r-n)),Math.round(this.options.extent*(t.y*r-o))]],tags:t.numPoints?m(t):this.points[t.index].properties},a=t.numPoints?t.id:this.points[t.index].id;void 0!==a&&(u.id=a),s.features.push(u)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))}_cluster(t,e){const n=[],{radius:o,extent:r,reduce:s}=this.options,i=o/(r*Math.pow(2,e));for(let o=0;o<t.length;o++){const r=t[o];if(r.zoom<=e)continue;r.zoom=e;const u=this.trees[e+1],a=u.within(r.x,r.y,i);let c=r.numPoints||1,p=r.x*c,f=r.y*c,l=s&&c>1?this._map(r,!0):null;const d=(o<<5)+(e+1);for(const t of a){const n=u.points[t];if(n.zoom<=e)continue;n.zoom=e;const o=n.numPoints||1;p+=n.x*o,f+=n.y*o,c+=o,n.parentId=d,s&&(l||(l=this._map(r,!0)),s(l,this._map(n)))}1===c?n.push(r):(r.parentId=d,n.push(h(p/c,f/c,d,c,l)))}return n}_map(t,e){if(t.numPoints)return e?M({},t.properties):t.properties;const n=this.points[t.index].properties,o=this.options.map(n);return e&&o===n?M({},o):o}}function h(t,e,n,o,r){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:o,properties:r}}function l(t,e){const[n,o]=t.geometry.coordinates;return{x:g(n),y:y(o),zoom:1/0,index:e,parentId:-1}}function d(t){return{type:"Feature",id:t.id,properties:m(t),geometry:{type:"Point",coordinates:[function(t){return 360*(t-.5)}(t.x),function(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(t.y)]}}}function m(t){const e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return M(M({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function g(t){return t/360+.5}function y(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function M(t,e){for(const n in e)t[n]=e[n];return t}function x(t){return t.x}function _(t){return t.y}},30:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.READY=1,e.SEARCH=2,e.ZOOM=3,e.MESSAGE_TO_WORKER={FETCH:1,SEARCH:2,ZOOM:3,EXPANSION:4}}});